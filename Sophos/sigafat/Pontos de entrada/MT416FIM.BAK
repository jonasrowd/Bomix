#Include "protheus.ch"
#Include "topconn.ch"

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MT416FIM  º Autor ³ Christian Rocha    º Data ³Novembro/2012º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Ponto de entrada acionado após o termino da efetivação do  º±±
±±º          ³ Orçamento de Venda.                                        º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ Bloqueia a arte caso o PV defina a situação da arte como   º±±
±±º          ³ nova ou alterada.                                          º±±
±±ÌÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±º                     A T U A L I Z A C O E S                           º±±
±±ÌÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDATA      ºANALISTA           ºALTERACOES                              º±±
±±º          º                   º                                        º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/

/* VERSÃO EM PRODUÇÃO ANTES DA ALTERAÇÃO DA ROTINA DE ARTE
User Function MT416FIM

	For i:=1 To Len(aCols)
		c_Produto := aCols[i][AScan(aHeader,{ |x| Alltrim(x[2]) == 'C6_PRODUTO' })]
	    c_SitArte := aCols[i][AScan(aHeader,{ |x| Alltrim(x[2]) == 'C6_FSTPITE' })]

	    If c_SitArte == '1' .Or. c_SitArte == '2'  //Se situação da arte for nova ou alterada
			dbSelectArea("SB1")
			dbGoTop()
			dbSetOrder(1)
			If dbSeek(xFilial("SB1")+c_Produto)
				If SB1->B1_FSFARTE == '1'		//Verifica se o flag de arte do produto está marcado com sim
					dbSelectArea("SZ2")
					dbGoTop()
					dbSetOrder(1)
					If dbSeek(xFilial("SZ2")+SB1->B1_FSARTE)
						RecLock("SZ2", .F.)
						SZ2->Z2_BLOQ := '1'		//Bloqueia a arte do produto
						MsUnlock()
					Endif
				Endif
			Endif
		Endif
	Next i
Return
*/

User Function MT416FIM
	For i:=1 To Len(aCols)
		If aCols[i][Len(aHeader) + 1] == .F.
			c_Produto := aCols[i][AScan(aHeader,{ |x| Alltrim(x[2]) == 'C6_PRODUTO' })]
		    c_SitArte := aCols[i][AScan(aHeader,{ |x| Alltrim(x[2]) == 'C6_FSTPITE' })]
	
		    If c_SitArte == '1'  //Se a arte for bloqueada
				dbSelectArea("SB1")
				dbGoTop()
				dbSetOrder(1)
				If dbSeek(xFilial("SB1")+c_Produto)
					If SB1->B1_FSFARTE == '1'		//Verifica se o flag de arte do produto está marcado com sim
						dbSelectArea("SZ2")
						dbGoTop()
						dbSetOrder(1)
						If dbSeek(xFilial("SZ2")+SB1->B1_FSARTE)
							RecLock("SZ2", .F.)
							SZ2->Z2_BLOQ := '2'		//Bloqueia a arte do produto
							SZ2->Z2_DATA := DDATABASE
							SZ2->Z2_RESP := UsrRetName(__CUSERID)
							MsUnlock()
							
							U_FALTSZ2()
						Endif
					Endif
				Endif
			Endif
		Endif
	Next i
Return