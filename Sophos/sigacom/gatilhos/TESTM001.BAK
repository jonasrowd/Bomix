#INCLUDE "TOPCONN.CH"
#INCLUDE "FWADAPTEREAI.CH"
#INCLUDE "protheus.CH"

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³TESTM001     º Autor ³ AP6 IDE            º Data ³  28/09/12º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Gatilho para gerar o código do produto                     º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP6 IDE                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/

User Function TESTM001
	a_Area   := GetArea()
	c_Grupo  := M->B1_GRUPO
	c_Codigo := M->B1_COD
	
	If INCLUI
		c_Qry := " SELECT MAX(SUBSTRING(B1_COD, 5, 5)) MAXSEQ FROM " + RetSqlName("SB1") + " SB1 " + chr(13) + chr(10)
		c_Qry += " WHERE SB1.D_E_L_E_T_ <> '*' AND B1_GRUPO = '" + M->B1_GRUPO + "' " + chr(13) + chr(10)	
		c_Qry += " AND B1_FILIAL = '" + XFILIAL("SB1") + "' "
		
		TCQUERY c_Qry NEW ALIAS "QRY"
	
		dbSelectArea("QRY")
		QRY->(dbGoTop())
		If QRY->(EoF())
			c_Seq := "00001"
		Else
			c_Seq := StrZero(Val(QRY->MAXSEQ) + 1, 5)
		Endif
		
		QRY->(dbCloseArea())		
		
		c_Codigo := c_Grupo + c_Seq
	Endif

	RestArea(a_Area)
Return c_Codigo

User Function TesteSB2
	nRecnoSM0  := SM0->(Recno()) 
	aSM0CodFil := {}
	
			dbSelectArea("SM0")
			dbGoTop()
			do While ! Eof()
				If SM0->M0_CODIGO == cEmpAnt
					Aadd(aSM0CodFil, FWGETCODFILIAL)
				Endif
				dbSkip()
			Enddo
			dbGoto(nRecnoSM0)

			cCod := "Z00A00001"

			dbSelectArea("SB2")      // saldos fisico e financeiro

			If(! Empty(FwFilial("SB2")) .and. Empty(FwFilial("SB1")))
				aFiliais := aClone(aSM0CodFil)
			Else
				aFiliais := {xFilial("SB2")}
			Endif

			For nBusca := 1 to Len(aFiliais)
				dbSeek(aFiliais[nBusca]+cCod)
				While !EOF() .And. aFiliais[nBusca]+cCod == B2_FILIAL+B2_COD
					If B2_QATU != 0
						HELP(" ",1,"MA0101")
						lErro := .T.
						Exit
					EndIf
					dbSkip()
				EndDo
			Next
Return			