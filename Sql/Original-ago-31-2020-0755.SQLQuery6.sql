SELECT DISTINCT A1.A1_COD 
, A1.A1_NOME
, A1.A1_LOJA  
, C5.C5_EMISSAO
, E1.E1_EMISSAO
, E1.E1_VENCTO
, A1.A1_OK
FROM SA1010 A1
LEFT JOIN SE1010 E1 
ON  --E1.E1_FILIAL = A1.A1_FILIAL  AND 
E1.E1_CLIENTE = A1.A1_COD   
AND E1.E1_LOJA = A1.A1_LOJA  
AND E1.D_E_L_E_T_ <> '*'
LEFT JOIN SC5010 C5
ON -- C5.C5_FILIAL = E1.E1_FILIAL  AND 
C5.C5_CLIENTE = E1.E1_CLIENTE   
AND C5.C5_LOJACLI = E1.E1_LOJA  
AND C5.D_E_L_E_T_ <> '*'
AND C5_EMISSAO IN (
SELECT MAX(C5_EMISSAO)
FROM  SC5010 (NOLOCK)
WHERE C5_CLIENTE = E1_CLIENTE  
AND   C5_LOJACLI = E1_LOJA     
AND   C5_EMISSAO <= E1_EMISSAO   
AND   C5_FILIAL = E1_FILIAL   
AND   D_E_L_E_T_ <>'*' )
LEFT JOIN SCJ010 CJ
ON  -- CJ.CJ_FILIAL = A1.A1_FILIAL  AND 
CJ.CJ_LOJA = A1.A1_LOJA 
AND  CJ.CJ_CLIENT = A1.A1_COD  
AND  CJ.D_E_L_E_T_ <> '*'
 WHERE E1.E1_BAIXA = ' '
 OR E1.E1_STATUS = 'A'
 AND C5.C5_NOTA = ' '
 AND A1.D_E_L_E_T_ <> '*'
 AND CJ.CJ_STATUS IN ('C','D')
 AND A1.A1_MSBLQL <> '1'
 AND A1.A1_COD BETWEEN '000001' AND '002083'
 AND A1.A1_ULTCOM BETWEEN '20150101' AND '20200827'
GROUP BY A1.A1_COD
,A1.A1_NOME
,A1.A1_LOJA
,C5.C5_EMISSAO
,E1.E1_EMISSAO
,E1.E1_VENCTO
,A1.A1_OK  