#include "totvs.ch"
#include "TbiConn.ch"
#include "topconn.ch"
#include "rwmake.ch"

/*/


Ŀ
Funo	  PMTPARAM	 Autor  Tito Duarte 		     Data  11.06.10 
Ĵ
Descricao  Rotina de Alteracao de Parametros dos Fechamentos     	  
Ĵ


/*/

USER FUNCTION PMTPARAM() 

/*
IF Alltrim(UPPER(Substr(cUsuario,7,15))) <> "ADMINISTRADOR" .AND. Alltrim(UPPER(Substr(cUsuario,7,15))) <> "WILLIANNE" .AND. Alltrim(UPPER(Substr(cUsuario,7,15))) <> "CASSIO"
   Msgbox("Apenas o Administrador tem Acesso a Esta Rotina","Atencao","ALERT")
   Return
ENDIF
     
IF Alltrim(UPPER(Substr(cUsuario,7,15))) = "WILLIANNE" .AND. nModulo = 06
   Msgbox("Apenas o Administrador tem Acesso a Esta Rotina","Atencao","ALERT")
   Return
ENDIF
*/

cALT1  := "N"
cALT2  := "N"
cALT3  := "N"
cALT4  := "N"
cALT5  := "N"
cPar1  := CTOD("  /  /  ")
cPar1  := Getmv("MV_DATAFIN")
cPar2  := CTOD("  /  /  ")
cPar2  := Getmv("MV_BXDTFIN")
cPar3  := CTOD("  /  /  ")
cPar3  := Getmv("MV_ULMES")
cPar4  := CTOD("  /  /  ")
cPar4  := Getmv("MV_DATAFIS")
cPar5  := CTOD("  /  /  ")
cPar5  := Getmv("MV_DATAREC")

// Msgbox("O Parametro esta Configurado para os Seguintes Modulos - Estoque(MV_ULMES), Financeiro(MV_DATAFIN) e Fiscal (MV_DATAFIS)","Atencao","ALERT")

@ 001,001 TO 460,500 DIALOG oDlg TITLE "Rotina de Bloqueio de Parametros"
*
@ 010,010 Say "* Ateno, o sistema s ir permitir lanamentos acima da data informada"
*
@ 030,010 Say "Parametro MV_DATAFIN-Fechamento Mensal (Financeiro) "
@ 040,010 Say "Deseja Alterar (S/N) ? "  
@ 040,070 Get cALT1  Picture "@!" Size 30,20 Valid Pertence("SN")
@ 040,130 Say "Data: "
@ 040,180 Get cPar1  Picture "@!" Size 50,20 When cALT1="S"
*
@ 065,010 Say "Parametro MV_BXDTFIN-Permitir baixa menor que parametro MV_DATAFIN"
@ 075,010 Say "Deseja Alterar (S/N) ?"
@ 075,070 Get cALT2  Picture "@!" Size 30,20 Valid Pertence("SN")
@ 075,130 Say "1=Permite/2=Nao ?"
@ 075,180 Get cPar2  Picture "@!" Size 50,20 When cALT2="S"

@ 100,010 Say "Parametro MV_ULMES-Fechamento Mensal (Estoque) "
@ 110,010 Say "Deseja Alterar (S/N) ? "  
@ 110,070 Get cALT3  Picture "@!" Size 30,20 Valid Pertence("SN")
@ 110,130 Say "Data: "
@ 110,180 Get cPar3  Picture "@!" Size 50,20 When cALT3="S"
*
@ 135,010 Say "Parametro MV_DATAFIS-Fechamento Mensal (Fiscal) "
@ 145,010 Say "Deseja Alterar (S/N) ? "  
@ 145,070 Get cALT4  Picture "@!" Size 30,20 Valid Pertence("SN")
@ 145,130 Say "Data: "
@ 145,180 Get cPar4  Picture "@!" Size 50,20 When cALT4="S"
*
@ 170,010 Say "Parametro MV_DATAREC-Data Limite Reconc Bancaria (Financeiro) "
@ 185,010 Say "Deseja Alterar (S/N) ? "  
@ 185,070 Get cALT5  Picture "@!" Size 30,20 Valid Pertence("SN")
@ 185,130 Say "Data: "
@ 185,180 Get cPar5  Picture "@!" Size 50,20 When cALT5="S"
*
@ 210,010 BMPBUTTON TYPE 01 ACTION Atualiza()
@ 210,070 BMPBUTTON TYPE 02 ACTION Close(oDlg)
*
ACTIVATE DIALOG oDlg CENTERED

Return


// Efetuar alterao dos parametros
Static Function Atualiza()

If cALT1=="S"
	dbselectarea("SX6")
	DBSEEK(XFILIAL()+"MV_DATAFIN")
	RecLock('SX6',.F.)
	SX6->X6_CONTEUD := DTOC(cPar1)
	MSUNLOCK()
Endif
If cALT2=="S"
	dbselectarea("SX6")
	DBSEEK(XFILIAL()+"MV_BXDTFIN")
	RecLock('SX6',.F.)
	SX6->X6_CONTEUD := cPar2
	MSUNLOCK()
Endif
If cALT3=="S"
	dbselectarea("SX6")
	DBSEEK(XFILIAL()+"MV_ULMES")
	RecLock('SX6',.F.)
	SX6->X6_CONTEUD := DTOC(cPar3)
	MSUNLOCK()
Endif
If cALT4=="S"
	dbselectarea("SX6")
	DBSEEK(XFILIAL()+"MV_DATAFIS")
	RecLock('SX6',.F.)
	SX6->X6_CONTEUD := DTOC(cPar4)
	MSUNLOCK()
Endif
If cALT5=="S"
	dbselectarea("SX6")
	DBSEEK(XFILIAL()+"MV_DATAREC")
	RecLock('SX6',.F.)
	SX6->X6_CONTEUD := DTOC(cPar5)
	MSUNLOCK()
Endif

Close(oDlg)

Return


User Function BLQFECHA() 
    *
	PREPARE ENVIRONMENT EMPRESA "01" FILIAL "01"    
	*
    cPar1 := DDATABASE - GETMV("MV_BLQMES1")
    cPar2 := DDATABASE - GETMV("MV_BLQMES2")
    *
	dbselectarea("SX6")
	DBSEEK(XFILIAL()+"MV_DATAFIN")
	RecLock('SX6',.F.)
	SX6->X6_CONTEUD := DTOC(cPar1)
	MSUNLOCK()
    *
	dbselectarea("SX6")
	DBSEEK(XFILIAL()+"MV_BXDTFIN")
	RecLock('SX6',.F.)
	SX6->X6_CONTEUD := DTOC(cPar1)
	MSUNLOCK()
    *
	dbselectarea("SX6")
	DBSEEK(XFILIAL()+"MV_ULMES")
	RecLock('SX6',.F.)
	SX6->X6_CONTEUD := DTOC(cPar1)
	MSUNLOCK()
    *
	dbselectarea("SX6")
	DBSEEK(XFILIAL()+"MV_DATAFIS")
	RecLock('SX6',.F.)
	SX6->X6_CONTEUD := DTOC(cPar1)
	MSUNLOCK()
	*
	dbselectarea("SX6")
	DBSEEK(XFILIAL()+"MV_DATAREC")
	RecLock('SX6',.F.)
	SX6->X6_CONTEUD := DTOC(cPar2)
	MSUNLOCK()
	*
	MSGBOX("ATUALIZADO COM SUCESSO !!!")
	*
RETURN

